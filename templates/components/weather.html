<div class="panel p-3">
    <div class="flex justify-between items-center mb-2">
        <h3 class="text-base font-bold text-yellow-500">☁️ WEATHER</h3>
        <div class="text-xs opacity-60 font-semibold">Davao City</div>
    </div>
    
    {% if weather and weather.current %}
    <!-- Feels Like Temperature & Weather Icon -->
    <div class="flex items-start justify-between mb-3">
        <div class="flex items-center gap-2">
            <!-- Temperature Icon based on value -->
            <div class="text-4xl">
                {% set temp = weather.current.temperature_2m %}
                {% if temp >= 35 %}🥵
                {% elif temp >= 30 %}🌡️
                {% elif temp >= 25 %}😊
                {% elif temp >= 20 %}😌
                {% elif temp >= 15 %}🧥
                {% else %}🥶
                {% endif %}
            </div>
            <div>
                <div class="text-xs opacity-60 mb-1">Current Temp</div>
                <div class="text-5xl font-bold leading-none">{{ "%.0f"|format(weather.current.temperature_2m) }}°</div>
                <div class="text-xs opacity-60 mt-1">Feels {{ "%.0f"|format(weather.current.apparent_temperature) }}°</div>
            </div>
        </div>
        <!-- Weather Icon -->
        <div class="text-right">
            <div class="text-4xl mb-1">
                {% set wcode = weather.current.weather_code %}
                {% if wcode == 0 %}☀️
                {% elif wcode in [1, 2] %}🌤️
                {% elif wcode == 3 %}☁️
                {% elif wcode in [45, 48] %}🌫️
                {% elif wcode in [51, 53, 55, 56, 57] %}🌦️
                {% elif wcode in [61, 63, 65, 66, 67, 80, 81, 82] %}🌧️
                {% elif wcode in [71, 73, 75, 77, 85, 86] %}🌨️
                {% elif wcode in [95, 96, 99] %}⛈️
                {% else %}🌡️
                {% endif %}
            </div>
            <!-- Sun Times (12-hour format) -->
            <div class="flex gap-2 text-xs">
                <div class="flex items-center gap-0.5">
                    <span class="text-yellow-500">☀️</span>
                    {% set sunrise_time = weather.daily.sunrise[0].split('T')[1][:5] if 'T' in weather.daily.sunrise[0] else weather.daily.sunrise[0] %}
                    {% set sunrise_hour = sunrise_time.split(':')[0]|int %}
                    {% set sunrise_min = sunrise_time.split(':')[1] %}
                    <span>{{ sunrise_hour }}:{{ sunrise_min }}</span>
                </div>
                <div class="flex items-center gap-0.5">
                    <span class="text-orange-500">🌇</span>
                    {% set sunset_time = weather.daily.sunset[0].split('T')[1][:5] if 'T' in weather.daily.sunset[0] else weather.daily.sunset[0] %}
                    {% set sunset_hour = sunset_time.split(':')[0]|int %}
                    {% set sunset_min = sunset_time.split(':')[1] %}
                    {% if sunset_hour > 12 %}
                        <span>{{ sunset_hour - 12 }}:{{ sunset_min }}</span>
                    {% else %}
                        <span>{{ sunset_hour }}:{{ sunset_min }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weather Details Grid (2 columns, clean rows with separators) -->
    <div class="text-xs sm:text-sm">
        <div class="grid grid-cols-2 gap-x-4 sm:gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>🌡️</span>
                    <span>High/Low</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.daily.temperature_2m_max[0]) }}°/{{ "%.0f"|format(weather.daily.temperature_2m_min[0]) }}°</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>💨</span>
                    <span>Wind</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.current.wind_speed_10m) }} km/h</div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-4 sm:gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>💧</span>
                    <span>Humidity</span>
                </div>
                <div class="font-semibold">{{ weather.current.relative_humidity_2m }}%</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>💦</span>
                    <span>Dew Point</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.current.temperature_2m - (100 - weather.current.relative_humidity_2m) / 5) }}°</div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-4 sm:gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>📊</span>
                    <span>Pressure</span>
                </div>
                <div class="font-semibold">{{ "%.1f"|format(weather.current.pressure_msl) }} mb</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>☀️</span>
                    <span class="hidden sm:inline">UV Index</span>
                    <span class="sm:hidden">UV</span>
                </div>
                <div class="font-semibold {% if weather.daily.uv_index_max[0] > 7 %}text-red-500{% elif weather.daily.uv_index_max[0] > 5 %}text-orange-500{% else %}text-green-500{% endif %}">
                    {{ "%.0f"|format(weather.daily.uv_index_max[0]) }}<span class="hidden sm:inline"> of 11</span>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-4 sm:gap-x-8 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>👁️</span>
                    <span>Visibility</span>
                </div>
                <div class="font-semibold">{{ "%.2f"|format(weather.hourly.visibility[0] / 1000) }} km</div>
            </div>
            {% if air_quality and air_quality.current and air_quality.current.us_aqi %}
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>🌫️</span>
                    <span>AQI</span>
                </div>
                <div class="font-semibold {% if air_quality.current.us_aqi > 100 %}text-red-500{% elif air_quality.current.us_aqi > 50 %}text-orange-500{% else %}text-green-500{% endif %}">
                    {{ air_quality.current.us_aqi }}
                </div>
            </div>
            {% endif %}
        </div>
        
        {% if air_quality and air_quality.current and air_quality.current.pm2_5 %}
        <div class="grid grid-cols-2 gap-x-4 sm:gap-x-8 py-2 border-t border-gray-200 dark:border-gray-700 pt-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>💨</span>
                    <span>PM2.5</span>
                </div>
                <div class="font-semibold {% if air_quality.current.pm2_5 > 55 %}text-red-500{% elif air_quality.current.pm2_5 > 35 %}text-orange-500{% elif air_quality.current.pm2_5 > 12 %}text-yellow-500{% else %}text-green-500{% endif %}">
                    {{ "%.1f"|format(air_quality.current.pm2_5) }} µg/m³
                </div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-1 sm:gap-2 opacity-60">
                    <span>🌬️</span>
                    <span>PM10</span>
                </div>
                <div class="font-semibold {% if air_quality.current.pm10 > 154 %}text-red-500{% elif air_quality.current.pm10 > 54 %}text-orange-500{% else %}text-green-500{% endif %}">
                    {{ "%.1f"|format(air_quality.current.pm10) }} µg/m³
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Tide Information -->
    {% if tide and (tide.next_high or tide.next_low) %}
    <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
        <h4 class="text-xs font-bold opacity-75 mb-2">🌊 TIDE SCHEDULE</h4>
        <div class="grid grid-cols-2 gap-2">
            {% if tide.next_high %}
            <div class="p-2 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                <div class="text-xs opacity-60 mb-1">High Tide</div>
                <div class="font-bold text-sm">{{ tide.next_high.time }}</div>
                <div class="text-xs opacity-75">{{ tide.next_high.height }}</div>
            </div>
            {% endif %}
            {% if tide.next_low %}
            <div class="p-2 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                <div class="text-xs opacity-60 mb-1">Low Tide</div>
                <div class="font-bold text-sm">{{ tide.next_low.time }}</div>
                <div class="text-xs opacity-75">{{ tide.next_low.height }}</div>
            </div>
            {% endif %}
        </div>
        <div class="text-xs opacity-30 mt-1 italic">Stormglass.io</div>
    </div>
    {% endif %}
    
    <!-- 6-Hour Forecast -->
    {% if weather.hourly and weather.hourly.time %}
    <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between mb-2">
            <h4 class="text-xs font-bold opacity-75">NEXT 6 HOURS</h4>
            <span class="text-xs opacity-50">Davao City</span>
        </div>
        
        <!-- Forecast Summary - Dynamic based on rain probability -->
        {% set max_precip = weather.hourly.precipitation_probability[1:7]|max %}
        <div class="mb-2 text-sm font-bold text-center py-1 rounded {% if max_precip >= 70 %}bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300{% elif max_precip >= 40 %}bg-blue-50 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400{% else %}bg-green-50 dark:bg-green-900/50 text-green-600 dark:text-green-400{% endif %}">
            {% if max_precip >= 70 %}
                High chance of rain in the next 6 hours
            {% elif max_precip >= 40 %}
                Possible rain showers expected
            {% else %}
                Clear conditions expected
            {% endif %}
        </div>
        
        <div class="grid grid-cols-3 sm:grid-cols-6 gap-1.5">
            {% for i in range(1, 7) %}
            <div class="text-center p-1.5 rounded bg-gray-50 dark:bg-gray-800">
                <!-- Time -->
                <div class="text-xs font-semibold mb-0.5">
                    {% set hour_str = weather.hourly.time[i].split('T')[1][:5] if 'T' in weather.hourly.time[i] else weather.hourly.time[i] %}
                    {% set hour = hour_str.split(':')[0]|int %}
                    {% if hour == 0 %}12AM
                    {% elif hour < 12 %}{{ hour }}AM
                    {% elif hour == 12 %}12PM
                    {% else %}{{ hour - 12 }}PM
                    {% endif %}
                </div>
                
                <!-- Weather Icon -->
                <div class="text-xl mb-0.5">
                    {% set wcode = weather.hourly.weather_code[i] %}
                    {% if wcode == 0 %}☀️
                    {% elif wcode in [1, 2] %}🌤️
                    {% elif wcode == 3 %}☁️
                    {% elif wcode in [45, 48] %}🌫️
                    {% elif wcode in [51, 53, 55, 56, 57] %}🌦️
                    {% elif wcode in [61, 63, 65, 66, 67, 80, 81, 82] %}🌧️
                    {% elif wcode in [71, 73, 75, 77, 85, 86] %}🌨️
                    {% elif wcode in [95, 96, 99] %}⛈️
                    {% else %}🌡️
                    {% endif %}
                </div>
                
                <!-- Temperature -->
                <div class="text-xs font-bold">{{ "%.0f"|format(weather.hourly.temperature_2m[i]) }}°</div>
                
                <!-- Precipitation Probability -->
                {% if weather.hourly.precipitation_probability[i] > 0 %}
                <div class="text-xs mt-0.5 {% if weather.hourly.precipitation_probability[i] >= 70 %}text-blue-500{% elif weather.hourly.precipitation_probability[i] >= 40 %}text-blue-400{% else %}text-blue-300{% endif %}">
                    💧{{ weather.hourly.precipitation_probability[i] }}%
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Typhoon & Rainfall Section -->
    <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <!-- Typhoon Status -->
            <div>
                <h4 class="text-sm font-bold mb-2 text-yellow-500">🌀 TYPHOON STATUS</h4>
                {% if typhoon %}
                    {% if typhoon.active %}
                    <div class="p-2 rounded bg-red-100 dark:bg-red-900 border border-red-500">
                        <div class="font-bold text-base">{{ typhoon.name }}</div>
                        <div class="text-sm mt-1 space-y-0.5">
                            <div><span class="opacity-75">Category:</span> {{ typhoon.category }}</div>
                            <div><span class="opacity-75">Wind Speed:</span> {{ typhoon.wind_speed }} km/h</div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-3 text-green-500 text-sm">✓ No active typhoon</div>
                    {% endif %}
                {% else %}
                <div class="text-center py-3 text-sm opacity-50">No data available</div>
                {% endif %}
                <div class="text-xs opacity-30 mt-1 italic">PAGASA</div>
            </div>
            
            <!-- Rainfall Monitor -->
            <div>
                <h4 class="text-sm font-bold mb-2 text-yellow-500">🌧️ RAINFALL MONITOR</h4>
                {% if rainfall %}
                <div class="mb-2 p-2 rounded text-center text-sm font-semibold
                    {% if rainfall.status == 'WARNING' %}bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300
                    {% elif rainfall.status == 'ADVISORY' %}bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300
                    {% else %}bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300{% endif %}">
                    {{ rainfall.intensity }} Intensity
                </div>
                <div class="space-y-1 text-sm">
                    <div class="flex justify-between">
                        <span class="opacity-75">Region:</span>
                        <span class="font-semibold">{{ rainfall.region }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="opacity-75">Flood Risk:</span>
                        <span class="font-semibold {% if rainfall.flood_risk == 'High' %}text-red-500{% elif rainfall.flood_risk == 'Moderate' %}text-orange-500{% else %}text-green-500{% endif %}">
                            {{ rainfall.flood_risk }}
                        </span>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-3 text-sm opacity-50">No data available</div>
                {% endif %}
                <div class="text-xs opacity-30 mt-1 italic">PAGASA</div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-8">No weather data available</div>
    {% endif %}
</div>
