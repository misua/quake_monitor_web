<div class="panel p-3">
    <h3 class="text-base font-bold mb-2 text-yellow-500">☁️ WEATHER</h3>
    
    {% if weather and weather.current %}
    <!-- Feels Like Temperature & Weather Icon -->
    <div class="flex items-start justify-between mb-3">
        <div class="flex items-center gap-2">
            <!-- Temperature Icon based on value -->
            <div class="text-4xl">
                {% set temp = weather.current.temperature_2m %}
                {% if temp >= 35 %}🥵
                {% elif temp >= 30 %}🌡️
                {% elif temp >= 25 %}😊
                {% elif temp >= 20 %}😌
                {% elif temp >= 15 %}🧥
                {% else %}🥶
                {% endif %}
            </div>
            <div>
                <div class="text-xs opacity-60 mb-1">Current Temp</div>
                <div class="text-5xl font-bold leading-none">{{ "%.0f"|format(weather.current.temperature_2m) }}°</div>
                <div class="text-xs opacity-60 mt-1">Feels {{ "%.0f"|format(weather.current.apparent_temperature) }}°</div>
            </div>
        </div>
        <!-- Weather Icon -->
        <div class="text-right">
            <div class="text-4xl mb-1">
                {% set wcode = weather.current.weather_code %}
                {% if wcode == 0 %}☀️
                {% elif wcode in [1, 2] %}🌤️
                {% elif wcode == 3 %}☁️
                {% elif wcode in [45, 48] %}🌫️
                {% elif wcode in [51, 53, 55, 56, 57] %}🌦️
                {% elif wcode in [61, 63, 65, 66, 67, 80, 81, 82] %}🌧️
                {% elif wcode in [71, 73, 75, 77, 85, 86] %}🌨️
                {% elif wcode in [95, 96, 99] %}⛈️
                {% else %}🌡️
                {% endif %}
            </div>
            <!-- Sun Times (12-hour format) -->
            <div class="flex gap-2 text-xs">
                <div class="flex items-center gap-0.5">
                    <span class="text-yellow-500">☀️</span>
                    {% set sunrise_time = weather.daily.sunrise[0].split('T')[1][:5] if 'T' in weather.daily.sunrise[0] else weather.daily.sunrise[0] %}
                    {% set sunrise_hour = sunrise_time.split(':')[0]|int %}
                    {% set sunrise_min = sunrise_time.split(':')[1] %}
                    <span>{{ sunrise_hour }}:{{ sunrise_min }}</span>
                </div>
                <div class="flex items-center gap-0.5">
                    <span class="text-orange-500">🌇</span>
                    {% set sunset_time = weather.daily.sunset[0].split('T')[1][:5] if 'T' in weather.daily.sunset[0] else weather.daily.sunset[0] %}
                    {% set sunset_hour = sunset_time.split(':')[0]|int %}
                    {% set sunset_min = sunset_time.split(':')[1] %}
                    {% if sunset_hour > 12 %}
                        <span>{{ sunset_hour - 12 }}:{{ sunset_min }}</span>
                    {% else %}
                        <span>{{ sunset_hour }}:{{ sunset_min }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weather Details Grid (2 columns, clean rows with separators) -->
    <div class="text-sm">
        <div class="grid grid-cols-2 gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>🌡️</span>
                    <span>High/Low</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.daily.temperature_2m_max[0]) }}°/{{ "%.0f"|format(weather.daily.temperature_2m_min[0]) }}°</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>💨</span>
                    <span>Wind</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.current.wind_speed_10m) }} km/h</div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>💧</span>
                    <span>Humidity</span>
                </div>
                <div class="font-semibold">{{ weather.current.relative_humidity_2m }}%</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>💦</span>
                    <span>Dew Point</span>
                </div>
                <div class="font-semibold">{{ "%.0f"|format(weather.current.temperature_2m - (100 - weather.current.relative_humidity_2m) / 5) }}°</div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-8 py-2 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>📊</span>
                    <span>Pressure</span>
                </div>
                <div class="font-semibold">{{ "%.1f"|format(weather.current.pressure_msl) }} mb</div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>☀️</span>
                    <span>UV Index</span>
                </div>
                <div class="font-semibold {% if weather.daily.uv_index_max[0] > 7 %}text-red-500{% elif weather.daily.uv_index_max[0] > 5 %}text-orange-500{% else %}text-green-500{% endif %}">
                    {{ "%.0f"|format(weather.daily.uv_index_max[0]) }} of 11
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-x-8 py-2">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>👁️</span>
                    <span>Visibility</span>
                </div>
                <div class="font-semibold">{{ "%.2f"|format(weather.hourly.visibility[0] / 1000) }} km</div>
            </div>
            {% if air_quality and air_quality.current and air_quality.current.us_aqi %}
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>🌫️</span>
                    <span>AQI</span>
                </div>
                <div class="font-semibold {% if air_quality.current.us_aqi > 100 %}text-red-500{% elif air_quality.current.us_aqi > 50 %}text-orange-500{% else %}text-green-500{% endif %}">
                    {{ air_quality.current.us_aqi }}
                </div>
            </div>
            {% else %}
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 opacity-60">
                    <span>🌙</span>
                    <span>Moon Phase</span>
                </div>
                <div class="font-semibold">Waning Gibbous</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Legend / Reference Guide -->
    <div class="mt-3 pt-2 border-t border-gray-200 dark:border-gray-700">
        <div class="text-xs space-y-1 opacity-40 italic">
            <div class="font-semibold mb-1">What These Mean:</div>
            <div class="grid grid-cols-2 gap-x-4 gap-y-0.5 text-xs">
                <div>Humidity: Moisture in air</div>
                <div>Dew Point: When dew forms</div>
                <div>Pressure: Atmospheric weight</div>
                <div>UV Index: Sun burn risk (0-11)</div>
                <div>Visibility: How far you can see</div>
                <div>AQI: Air quality (0-500)</div>
            </div>
        </div>
    </div>
    
    <!-- Source Attribution -->
    <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700">
        <p class="text-xs opacity-30 text-center italic">Data from Open-Meteo API</p>
    </div>
    {% else %}
    <div class="text-center py-8">No weather data available</div>
    {% endif %}
</div>
