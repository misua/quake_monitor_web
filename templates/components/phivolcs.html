<div class="panel p-3">
    <div class="flex justify-between items-center mb-3">
        <h2 class="text-sm sm:text-base font-bold text-yellow-500">ðŸ”” PHIVOLCS</h2>
        <div class="text-xs opacity-50">Recent Earthquakes</div>
    </div>
    
    {% if earthquakes %}
    <!-- Grid: Latest Earthquake + List (left) and Map (right) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <!-- Left: Latest Earthquake + Previous List -->
        <div>
            <!-- Latest Earthquake - HUGE Display for Distance Viewing -->
            <div class="bg-gray-800 dark:bg-gray-900 text-white rounded-lg p-4 mb-3">
                <div class="text-sm font-bold text-yellow-400 mb-3">ðŸ”” LATEST EARTHQUAKE</div>
                
                <!-- HUGE Magnitude Badge -->
                <div class="mb-3">
                    <div class="inline-block px-6 py-4 rounded-lg
                        {% if earthquakes[0].magnitude|float >= 6.0 %}bg-red-500
                        {% elif earthquakes[0].magnitude|float >= 4.0 %}bg-orange-500
                        {% else %}bg-green-500{% endif %}">
                        <div class="text-6xl sm:text-7xl font-black text-white leading-none">{{ earthquakes[0].magnitude }}</div>
                        <div class="text-sm font-bold text-white mt-1 text-center">MAGNITUDE</div>
                    </div>
                </div>
                
                <!-- LARGE Location Text -->
                <div class="mb-2">
                    <div class="text-2xl sm:text-3xl font-bold leading-tight">{{ earthquakes[0].location }}</div>
                </div>
                
                <!-- Large Time -->
                <div class="text-lg sm:text-xl opacity-90">{{ earthquakes[0].datetime }}</div>
                
                <!-- Depth if available -->
                {% if earthquakes[0].depth %}
                <div class="text-base opacity-75 mt-2">Depth: {{ earthquakes[0].depth }}</div>
                {% endif %}
            </div>
            
            <!-- Previous Earthquakes List -->
            <div class="space-y-1">
                {% for eq in earthquakes[1:6] %}
                <div class="flex gap-2 items-center p-1.5 rounded bg-gray-50 dark:bg-gray-800 text-xs"
                     data-eq-id="{{ eq.id }}"
                     data-magnitude="{{ eq.magnitude }}"
                     data-location="{{ eq.location }}">
                    <!-- Magnitude Badge -->
                    <div class="flex-shrink-0 w-10 h-10 rounded flex items-center justify-center font-bold text-white text-sm
                        {% if eq.magnitude|float >= 6.0 %}bg-red-500
                        {% elif eq.magnitude|float >= 4.0 %}bg-orange-500
                        {% else %}bg-green-500{% endif %}">
                        {{ eq.magnitude }}
                    </div>
                    
                    <!-- Details -->
                    <div class="flex-1">
                        <div class="font-medium leading-tight">{{ eq.location[:45] }}{% if eq.location|length > 45 %}...{% endif %}</div>
                        <div class="opacity-60 mt-0.5">{{ eq.datetime }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Right: Map -->
        <div>
            {% if earthquakes[0].latitude and earthquakes[0].longitude %}
            <div id="phivolcs-map" class="w-full h-full rounded border border-gray-300 dark:border-gray-700" style="min-height: 250px;"></div>
            <script>
                (function() {
                    // Remove existing map if it exists
                    var mapContainer = document.getElementById('phivolcs-map');
                    if (mapContainer._leaflet_id) {
                        mapContainer._leaflet_id = undefined;
                        mapContainer.innerHTML = '';
                    }
                    
                    // Wait for Leaflet to be available
                    if (typeof L !== 'undefined') {
                        var map = L.map('phivolcs-map', {
                            zoomControl: false,
                            attributionControl: false
                        }).setView([{{ earthquakes[0].latitude }}, {{ earthquakes[0].longitude }}], 8);
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19
                        }).addTo(map);
                        
                        // Add marker for the earthquake
                        var magnitude = '{{ earthquakes[0].magnitude }}';
                        var location = '{{ earthquakes[0].location|replace("'", "\\'") }}';
                        var datetime = '{{ earthquakes[0].datetime }}';
                        
                        var marker = L.circleMarker([{{ earthquakes[0].latitude }}, {{ earthquakes[0].longitude }}], {
                            radius: 10,
                            fillColor: '{% if earthquakes[0].magnitude|float >= 6.0 %}#ef4444{% elif earthquakes[0].magnitude|float >= 4.0 %}#f97316{% else %}#22c55e{% endif %}',
                            color: '#fff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        }).addTo(map);
                        
                        var popupContent = '<div style="min-width: 150px; color: #000;">' +
                            '<div style="font-weight: bold; font-size: 14px; margin-bottom: 4px; color: #000;">Magnitude ' + magnitude + '</div>' +
                            '<div style="margin-bottom: 4px; color: #000;">' + (location.length > 40 ? location.substring(0, 40) + '...' : location) + '</div>' +
                            '<div style="font-size: 11px; opacity: 0.7; color: #333;">' + datetime + '</div>' +
                            '</div>';
                        
                        marker.bindPopup(popupContent).openPopup();
                    }
                })();
            </script>
            {% else %}
            <div class="w-full h-full flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded" style="min-height: 250px;">
                <p class="text-xs opacity-75">No location data</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-8">No earthquake data available</div>
    {% endif %}
</div>
