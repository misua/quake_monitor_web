<div class="panel p-3">
    <div class="flex justify-between items-start mb-2">
        <div>
            <h3 class="text-lg font-bold text-yellow-500">PHIVOLCS EARTHQUAKE MONITOR</h3>
            <p class="text-xs opacity-75">Source: PHIVOLCS (Real-time, Philippines)</p>
        </div>
        <div class="text-xs opacity-50">
            <span id="phivolcs-update-time"></span>
            <script>
                document.getElementById('phivolcs-update-time').textContent = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            </script>
        </div>
    </div>
    
    {% if earthquakes %}
    <!-- Grid: Earthquake List (left) and Map (right) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <!-- Left: Earthquake List -->
        <div class="space-y-1.5">
        {% for eq in earthquakes[:6] %}
        <div class="flex gap-2 {% if loop.index == 1 %}p-1.5{% else %}p-1{% endif %} rounded {% if loop.index == 1 %}bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700{% else %}bg-gray-50 dark:bg-gray-800{% endif %}"
             data-eq-id="{{ eq.id }}"
             data-magnitude="{{ eq.magnitude }}"
             data-location="{{ eq.location }}">
            <!-- Magnitude Badge -->
            <div class="flex-shrink-0 {% if loop.index == 1 %}w-12 h-10{% else %}w-10 h-8{% endif %} rounded flex items-center justify-center font-bold text-white {% if loop.index == 1 %}text-sm{% else %}text-xs{% endif %}
                {% if eq.magnitude|float >= 6.0 %}bg-red-500
                {% elif eq.magnitude|float >= 4.0 %}bg-orange-500
                {% else %}bg-green-500{% endif %}">
                {{ eq.magnitude }}
            </div>
            
            <!-- Details -->
            <div class="flex-1 {% if loop.index == 1 %}text-xs{% else %}text-xs{% endif %}">
                <div class="{% if loop.index == 1 %}font-semibold{% else %}font-medium{% endif %} leading-tight {% if loop.index > 1 %}opacity-75{% endif %}">{{ eq.location[:40] }}{% if eq.location|length > 40 %}...{% endif %}</div>
                <div class="opacity-75 mt-0.5 {% if loop.index > 1 %}text-xs{% endif %}">{{ eq.datetime }}</div>
            </div>
        </div>
        {% endfor %}
        </div>
        
        <!-- Right: Map -->
        <div>
            {% if earthquakes[0].latitude and earthquakes[0].longitude %}
            <div id="phivolcs-map" class="w-full h-full rounded border border-gray-300 dark:border-gray-700" style="min-height: 250px;"></div>
            <script>
                (function() {
                    // Remove existing map if it exists
                    var mapContainer = document.getElementById('phivolcs-map');
                    if (mapContainer._leaflet_id) {
                        mapContainer._leaflet_id = undefined;
                        mapContainer.innerHTML = '';
                    }
                    
                    // Wait for Leaflet to be available
                    if (typeof L !== 'undefined') {
                        var map = L.map('phivolcs-map', {
                            zoomControl: false,
                            attributionControl: false
                        }).setView([{{ earthquakes[0].latitude }}, {{ earthquakes[0].longitude }}], 8);
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19
                        }).addTo(map);
                        
                        // Add marker for the earthquake
                        var magnitude = '{{ earthquakes[0].magnitude }}';
                        var location = '{{ earthquakes[0].location|replace("'", "\\'") }}';
                        var datetime = '{{ earthquakes[0].datetime }}';
                        
                        var marker = L.circleMarker([{{ earthquakes[0].latitude }}, {{ earthquakes[0].longitude }}], {
                            radius: 10,
                            fillColor: '{% if earthquakes[0].magnitude|float >= 6.0 %}#ef4444{% elif earthquakes[0].magnitude|float >= 4.0 %}#f97316{% else %}#22c55e{% endif %}',
                            color: '#fff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        }).addTo(map);
                        
                        var popupContent = '<div style="min-width: 150px;">' +
                            '<div style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">Magnitude ' + magnitude + '</div>' +
                            '<div style="margin-bottom: 4px;">' + (location.length > 40 ? location.substring(0, 40) + '...' : location) + '</div>' +
                            '<div style="font-size: 11px; opacity: 0.7;">' + datetime + '</div>' +
                            '</div>';
                        
                        marker.bindPopup(popupContent).openPopup();
                    }
                })();
            </script>
            {% else %}
            <div class="w-full h-full flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded" style="min-height: 250px;">
                <p class="text-xs opacity-75">No location data</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-8">No earthquake data available</div>
    {% endif %}
</div>
